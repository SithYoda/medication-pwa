<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Test Data</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2>Add Test Data</h2>
        
        <div class="card mb-3">
            <div class="card-header">1. Add User</div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="userName" class="form-label">Username</label>
                    <input type="text" class="form-control" id="userName" value="John Doe">
                </div>
                <div class="mb-3">
                    <label for="userEmail" class="form-label">Email</label>
                    <input type="email" class="form-control" id="userEmail" value="john@example.com">
                </div>
                <button class="btn btn-primary" onclick="addUser()">Add User</button>
                <div id="userResult" class="mt-2"></div>
            </div>
        </div>

        <div class="card mb-3">
            <div class="card-header">2. Add Medication</div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="medName" class="form-label">Medication Name</label>
                    <input type="text" class="form-control" id="medName" value="Paracetamol">
                </div>
                <div class="mb-3">
                    <label for="commonName" class="form-label">Common Name</label>
                    <input type="text" class="form-control" id="commonName" value="Acetaminophen">
                </div>
                <div class="mb-3">
                    <label for="strength" class="form-label">Strength</label>
                    <input type="text" class="form-control" id="strength" value="500mg">
                </div>
                <div class="mb-3">
                    <label for="qtyRepeat" class="form-label">Quantity per Repeat</label>
                    <input type="number" class="form-control" id="qtyRepeat" value="100">
                </div>
                <div class="mb-3">
                    <label for="price" class="form-label">Price ($)</label>
                    <input type="number" class="form-control" id="price" value="5.99" step="0.01">
                </div>
                <button class="btn btn-primary" onclick="addMedication()">Add Medication</button>
                <div id="medResult" class="mt-2"></div>
            </div>
        </div>

        <div class="card mb-3">
            <div class="card-header">3. Add User Med Chart</div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="chartUserId" class="form-label">User ID</label>
                    <input type="number" class="form-control" id="chartUserId" value="1">
                </div>
                <div class="mb-3">
                    <label for="chartMedId" class="form-label">Medication ID</label>
                    <input type="number" class="form-control" id="chartMedId" value="1">
                </div>
                <div class="mb-3">
                    <label for="stocktake" class="form-label">Current Stock</label>
                    <input type="number" class="form-control" id="stocktake" value="50">
                </div>
                <div class="mb-3">
                    <label for="repeats" class="form-label">Repeats Available</label>
                    <input type="number" class="form-control" id="repeats" value="2">
                </div>
                <div class="mb-3">
                    <label for="dosageAM" class="form-label">Dosage AM</label>
                    <input type="number" class="form-control" id="dosageAM" value="1" step="0.5">
                </div>
                <div class="mb-3">
                    <label for="dosagePM" class="form-label">Dosage PM</label>
                    <input type="number" class="form-control" id="dosagePM" value="1" step="0.5">
                </div>
                <div class="mb-3">
                    <label for="dosageWeekly" class="form-label">Once Per Week Dosage</label>
                    <input type="number" class="form-control" id="dosageWeekly" value="0" step="0.5">
                </div>
                <button class="btn btn-primary" onclick="addChart()">Add Chart Entry</button>
                <div id="chartResult" class="mt-2"></div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://darthyoda.pythonanywhere.com';

        async function addUser() {
            try {
                const response = await fetch(`${API_URL}/users`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        Users: document.getElementById('userName').value,
                        Email: document.getElementById('userEmail').value,
                        Admin: false
                    })
                });
                
                if (!response.ok) {
                    const text = await response.text();
                    throw new Error(`HTTP ${response.status}: ${text}`);
                }
                
                const data = await response.json();
                document.getElementById('userResult').innerHTML = 
                    `<div class="alert alert-success">✅ User added! ID: ${data.UsrID}</div>`;
            } catch (error) {
                console.error('Full error:', error);
                document.getElementById('userResult').innerHTML = 
                    `<div class="alert alert-danger">❌ Error: ${error.message}</div>`;
            }
        }

        async function addMedication() {
            try {
                const response = await fetch(`${API_URL}/medications`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        MedicationName: document.getElementById('medName').value,
                        CommonName: document.getElementById('commonName').value,
                        MedicationStrength: document.getElementById('strength').value,
                        QtyRepeat: parseInt(document.getElementById('qtyRepeat').value),
                        Price: parseFloat(document.getElementById('price').value)
                    })
                });
                
                if (!response.ok) {
                    const text = await response.text();
                    throw new Error(`HTTP ${response.status}: ${text}`);
                }
                
                const data = await response.json();
                document.getElementById('medResult').innerHTML = 
                    `<div class="alert alert-success">✅ Medication added! ID: ${data.MedIDs}</div>`;
            } catch (error) {
                console.error('Full error:', error);
                document.getElementById('medResult').innerHTML = 
                    `<div class="alert alert-danger">❌ Error: ${error.message}</div>`;
            }
        }

        async function addChart() {
            const payload = {
                UsrID: parseInt(document.getElementById('chartUserId').value),
                MedIDs: parseInt(document.getElementById('chartMedId').value),
                Stocktake: parseInt(document.getElementById('stocktake').value),
                Repeats: parseInt(document.getElementById('repeats').value),
                DosageAM: parseFloat(document.getElementById('dosageAM').value),
                DosagePM: parseFloat(document.getElementById('dosagePM').value),
                DosageOncePerWeek: parseFloat(document.getElementById('dosageWeekly').value),
                ReorderLevel: 14,
                PurchaseDayOfMonth: 15
            };
            
            console.log('Sending payload:', payload);
            
            try {
                const response = await fetch(`${API_URL}/user-med-chart`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                console.log('Response status:', response.status);
                const text = await response.text();
                console.log('Response text:', text);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${text}`);
                }
                
                const data = JSON.parse(text);
                document.getElementById('chartResult').innerHTML = 
                    `<div class="alert alert-success">✅ Chart entry added successfully!</div>`;
            } catch (error) {
                console.error('Full error:', error);
                document.getElementById('chartResult').innerHTML = 
                    `<div class="alert alert-danger">❌ Error: ${error.message}<br><small>Check browser console (F12) for details</small></div>`;
            }
        }
    </script>
</body>
</html>